---
import { getCollection } from "astro:content";
import Container from "@components/Container.astro";
import PageLayout from "@layouts/PageLayout.astro";
import ArrowCard from "@components/ArrowCard.astro";
import Link from "@components/Link.astro";

export async function getStaticPaths() {
  const blog = await getCollection("blog");
  const tags = new Set(blog.flatMap(post => post.data.tags || []));
  return Array.from(tags).map(tag => ({
    params: { tag },
    props: { tag }
  }));
}

const { tag } = Astro.props;
const allPosts = await getCollection("blog");
const posts = allPosts
  .filter(post => !post.data.draft && (post.data.tags || []).includes(tag))
  .sort((a, b) => b.data.date.valueOf() - a.data.date.valueOf());
---

<PageLayout title={`Blog - ${tag}`} description={`Posts tagged with ${tag}`}>
  <Container>
    <div class="space-y-10">
      <div class="space-y-4">
        <div class="animate flex justify-between items-center">
          <div class="font-semibold text-black dark:text-white">
            Tag: <span class="text-black dark:text-white">#{tag}</span>
          </div>
          <Link href="/blog" underline={true}>
            ls -a
          </Link>
        </div>
        <div class="animate text-sm text-black/50 dark:text-white/75">
          {posts.length} {posts.length === 1 ? "post" : "posts"}
        </div>
      </div>
      <div class="space-y-4">
        <div>
          <ul class="flex flex-col gap-4">
            {
              posts.map((post) => (
                <li class="animate">
                  <ArrowCard entry={post}/>
                </li>
              ))
            }
          </ul>
        </div>
      </div>
    </div>
  </Container>
</PageLayout>
